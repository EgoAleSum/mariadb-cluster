<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <title>Template generator</title>
  
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  
  <!-- highlight.js -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/styles/default.min.css">
</head>

<body>
  <div class="container" gen-role="page" gen-page="form">
    <div class="page-header">
      <h1>Template generator</h1>
    </div>
    
    <form class="form-horizontal" id="generator-form">
      <h2>Mode</h2>
      <div>
        <span class="btn btn-default" gen-role="mode" gen-mode="arm">Azure Resource Manager template</span>
        <span class="btn btn-default" gen-role="mode" gen-mode="cloudconfig">Only cloud-config.yaml</span>
      </div>
      
      <h2>Parameters</h2>
      <div class="form-group" gen-role="conditional-param" gen-mode="arm">
        <label for="node-count" class="col-sm-3 control-label">Number of nodes</label>
        <div class="col-sm-3">
          <select name="node-count" id="node-count" class="form-control" required>
            <option value="3">3</option>
            <option value="5">5</option>
          </select>
        </div>
      </div>
      <div class="form-group" gen-role="conditional-param" gen-mode="arm">
        <label for="node-size" class="col-sm-3 control-label">Node size</label>
        <div class="col-sm-3">
          <select name="node-size" id="node-size" class="form-control" required></select>
        </div>
      </div>
      <div class="form-group" gen-role="conditional-param" gen-mode="arm">
        <label for="data-disks" class="col-sm-3 control-label">Number of data disks per node</label>
        <div class="col-sm-3">
          <select name="data-disks" id="data-disks" class="form-control" required></select>
          <div class="small help-block">Stripe across N data disks, each one with 1,023GB size and 500 IOPs. Each VM size has a limit on number of data disks; please note that this setting may limit your ability to scale down a node.</div> 
        </div>
      </div>
      <div class="form-group" gen-role="conditional-param" gen-mode="arm">
        <label for="storage-account-prefix" class="col-sm-3 control-label">Storage Account name prefix</label>
        <div class="col-sm-3">
          <input name="storage-account-prefix" id="storage-account-prefix" class="form-control" required pattern="[0-9a-z]{1,7}" />
          <div class="small help-block">Must be 1-7 characters, lowercase characters and numbers only</div> 
        </div>
      </div>
      <div class="form-group" gen-role="conditional-param" gen-mode="arm">
        <label for="ssh-key" class="col-sm-3 control-label">SSH key</label>
        <div class="col-sm-6">
          <textarea name="ssh-key" id="ssh-key" class="form-control" rows="3" required></textarea>
          <div class="small help-block"><code>ssh-keygen</code> format</div>
        </div>
      </div>
      <div class="form-group" gen-role="conditional-param" gen-mode="arm">
        <label for="admin-username" class="col-sm-3 control-label">SSH user name</label>
        <div class="col-sm-3">
          <input name="admin-username" id="admin-username" class="form-control" required pattern="[a-z_][a-z0-9_-]*" value="core" />
          <div class="small help-block">Lowercase characters, numbers and _- only. Must start with a character or underscore.</div> 
        </div>
      </div>
      <!--<div class="form-group" gen-role="conditional-param" gen-mode="arm">
        <div class="col-sm-offset-3 col-sm-9">
          <div class="checkbox">
            <label>
              <input type="checkbox"> Use premium storage
            </label>
          </div>
        </div>
      </div>-->
      <div class="form-group" gen-role="conditional-param" gen-mode="cloudconfig">
        <label for="etcd-node-count" class="col-sm-3 control-label">etcd2 cluster size</label>
        <div class="col-sm-3">
          <input name="etcd-node-count" id="etcd-node-count" class="form-control" required type="number" value="3" min="1" />
          <div class="small help-block">Initial number of nodes required by etcd2 for bootstrapping.</div>
        </div>
      </div>
      <div class="form-group" gen-role="conditional-param" gen-mode="cloudconfig">
        <label for="vcpu-count" class="col-sm-3 control-label">Number of vCPUs per VM</label>
        <div class="col-sm-3">
          <input name="vcpu-count" id="vcpu-count" class="form-control" required type="number" value="1" min="0" max="32" />
          <div class="small help-block">Number of vCPUs in each VM, for optimizing <em>wsrep</em> slave threads. If unsure, set this value to 0 (will use 1 slave thread).</div> 
        </div>
      </div>
      
      <h2>Optional parameters</h2>
      <div class="form-group">
        <label for="etcd-discovery-url" class="col-sm-3 control-label">etcd2 discovery URL</label>
        <div class="col-sm-6">
          <input name="etcd-discovery-url" id="etcd-discovery-url" class="form-control" type="url" placeholder="https://discovery.etcd.io/abcdef1234567890abcdef1234567890" />
          <div class="small help-block"><strong>Leave empty to generate automatically (recommended for new clusters).</strong> Can be obtained from <code>http://discovery.etcd.io/new?size=x</code> (replace "x" with the initial size of the etcd2 cluster, as necessary for bootstrapping).</div> 
        </div>
      </div>
      
      <div class="form-group">
        <div class="col-sm-offset-3 col-sm-9">
          <button type="submit" class="btn btn-primary" gen-role="generate-button">Generate</button>
        </div>
      </div>
    </form>
  </div>
  
  <div class="container" gen-role="page" gen-page="output">
    <div class="page-header">
      <h1>Generated documents</h1>
    </div>
    
    <button type="button" class="btn btn-default" gen-role="restart-button">Restart</button>
    
    <div gen-role="output" gen-content="arm">
      <h2>Azure Resource Manager template</h2>
      <pre><code class="json"></code></pre>
    </div>
    
    <div gen-role="output" gen-content="yaml">
      <h2>cloud-config.yaml</h2>
      <pre><code class="yaml"></code></pre>
    </div>
    
    <div gen-role="output" gen-content="yamlb64">
      <h2>cloud-config.yaml (base64-encoded)</h2>
      <pre><code class="nohighlight"></code></pre>
    </div>
  </div>
  
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>

<script type="text/javascript">/* js-yaml 3.6.0 https://github.com/nodeca/js-yaml */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.jsyaml=e()}}(function(){return function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return r(n?n:e)},l,l.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){"use strict";function i(e){return function(){throw new Error("Function "+e+" is deprecated and cannot be used.")}}var r=e("./js-yaml/loader"),o=e("./js-yaml/dumper");t.exports.Type=e("./js-yaml/type"),t.exports.Schema=e("./js-yaml/schema"),t.exports.FAILSAFE_SCHEMA=e("./js-yaml/schema/failsafe"),t.exports.JSON_SCHEMA=e("./js-yaml/schema/json"),t.exports.CORE_SCHEMA=e("./js-yaml/schema/core"),t.exports.DEFAULT_SAFE_SCHEMA=e("./js-yaml/schema/default_safe"),t.exports.DEFAULT_FULL_SCHEMA=e("./js-yaml/schema/default_full"),t.exports.load=r.load,t.exports.loadAll=r.loadAll,t.exports.safeLoad=r.safeLoad,t.exports.safeLoadAll=r.safeLoadAll,t.exports.dump=o.dump,t.exports.safeDump=o.safeDump,t.exports.YAMLException=e("./js-yaml/exception"),t.exports.MINIMAL_SCHEMA=e("./js-yaml/schema/failsafe"),t.exports.SAFE_SCHEMA=e("./js-yaml/schema/default_safe"),t.exports.DEFAULT_SCHEMA=e("./js-yaml/schema/default_full"),t.exports.scan=i("scan"),t.exports.parse=i("parse"),t.exports.compose=i("compose"),t.exports.addConstructor=i("addConstructor")},{"./js-yaml/dumper":3,"./js-yaml/exception":4,"./js-yaml/loader":5,"./js-yaml/schema":7,"./js-yaml/schema/core":8,"./js-yaml/schema/default_full":9,"./js-yaml/schema/default_safe":10,"./js-yaml/schema/failsafe":11,"./js-yaml/schema/json":12,"./js-yaml/type":13}],2:[function(e,t,n){"use strict";function i(e){return"undefined"==typeof e||null===e}function r(e){return"object"==typeof e&&null!==e}function o(e){return Array.isArray(e)?e:i(e)?[]:[e]}function a(e,t){var n,i,r,o;if(t)for(o=Object.keys(t),n=0,i=o.length;i>n;n+=1)r=o[n],e[r]=t[r];return e}function s(e,t){var n,i="";for(n=0;t>n;n+=1)i+=e;return i}function c(e){return 0===e&&Number.NEGATIVE_INFINITY===1/e}t.exports.isNothing=i,t.exports.isObject=r,t.exports.toArray=o,t.exports.repeat=s,t.exports.isNegativeZero=c,t.exports.extend=a},{}],3:[function(e,t,n){"use strict";function i(e,t){var n,i,r,o,a,s,c;if(null===t)return{};for(n={},i=Object.keys(t),r=0,o=i.length;o>r;r+=1)a=i[r],s=String(t[a]),"!!"===a.slice(0,2)&&(a="tag:yaml.org,2002:"+a.slice(2)),c=e.compiledTypeMap[a],c&&L.call(c.styleAliases,s)&&(s=c.styleAliases[s]),n[a]=s;return n}function r(e){var t,n,i;if(t=e.toString(16).toUpperCase(),255>=e)n="x",i=2;else if(65535>=e)n="u",i=4;else{if(!(4294967295>=e))throw new N("code point within a string may not be greater than 0xFFFFFFFF");n="U",i=8}return"\\"+n+F.repeat("0",i-t.length)+t}function o(e){this.schema=e.schema||M,this.indent=Math.max(1,e.indent||2),this.skipInvalid=e.skipInvalid||!1,this.flowLevel=F.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=i(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function a(e,t){for(var n,i=F.repeat(" ",t),r=0,o=-1,a="",s=e.length;s>r;)o=e.indexOf("\n",r),-1===o?(n=e.slice(r),r=s):(n=e.slice(r,o+1),r=o+1),n.length&&"\n"!==n&&(a+=i),a+=n;return a}function s(e,t){return"\n"+F.repeat(" ",e.indent*t)}function c(e,t){var n,i,r;for(n=0,i=e.implicitTypes.length;i>n;n+=1)if(r=e.implicitTypes[n],r.resolve(t))return!0;return!1}function u(e){return e===q||e===D}function l(e){return e>=32&&126>=e||e>=161&&55295>=e&&8232!==e&&8233!==e||e>=57344&&65533>=e&&65279!==e||e>=65536&&1114111>=e}function p(e){return l(e)&&65279!==e&&e!==H&&e!==Q&&e!==X&&e!==te&&e!==ie&&e!==V&&e!==B}function f(e){return l(e)&&65279!==e&&!u(e)&&e!==G&&e!==z&&e!==V&&e!==H&&e!==Q&&e!==X&&e!==te&&e!==ie&&e!==B&&e!==W&&e!==$&&e!==Y&&e!==ne&&e!==Z&&e!==K&&e!==R&&e!==P&&e!==J&&e!==ee}function d(e,t,n,i,r){var o,a,s=!1,c=!1,d=-1!==i,h=-1,m=f(e.charCodeAt(0))&&!u(e.charCodeAt(e.length-1));if(t)for(o=0;o<e.length;o++){if(a=e.charCodeAt(o),!l(a))return le;m=m&&p(a)}else{for(o=0;o<e.length;o++){if(a=e.charCodeAt(o),a===U)s=!0,d&&(c=c||o-h-1>i&&" "!==e[h+1],h=o);else if(!l(a))return le;m=m&&p(a)}c=c||d&&o-h-1>i&&" "!==e[h+1]}return s||c?" "===e[0]&&n>9?le:c?ue:ce:m&&!r(e)?ae:se}function h(e,t,n,i){e.dump=function(){function r(t){return c(e,t)}if(0===t.length)return"''";if(!e.noCompatMode&&-1!==oe.indexOf(t))return"'"+t+"'";var o=e.indent*Math.max(1,n),s=-1===e.lineWidth?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-o),u=i||e.flowLevel>-1&&n>=e.flowLevel;switch(d(t,u,e.indent,s,r)){case ae:return t;case se:return"'"+t.replace(/'/g,"''")+"'";case ce:return"|"+m(t,e.indent)+g(a(t,o));case ue:return">"+m(t,e.indent)+g(a(y(t,s),o));case le:return'"'+v(t,s)+'"';default:throw new N("impossible error: invalid scalar style")}}()}function m(e,t){var n=" "===e[0]?String(t):"",i="\n"===e[e.length-1],r=i&&("\n"===e[e.length-2]||"\n"===e),o=r?"+":i?"":"-";return n+o+"\n"}function g(e){return"\n"===e[e.length-1]?e.slice(0,-1):e}function y(e,t){for(var n,i,r=/(\n+)([^\n]*)/g,o=function(){var n=e.indexOf("\n");return n=-1!==n?n:e.length,r.lastIndex=n,x(e.slice(0,n),t)}(),a="\n"===e[0]||" "===e[0];i=r.exec(e);){var s=i[1],c=i[2];n=" "===c[0],o+=s+(a||n||""===c?"":"\n")+x(c,t),a=n}return o}function x(e,t){if(""===e||" "===e[0])return e;for(var n,i,r=/ [^ ]/g,o=0,a=0,s=0,c="";n=r.exec(e);)s=n.index,s-o>t&&(i=a>o?a:s,c+="\n"+e.slice(o,i),o=i+1),a=s;return c+="\n",c+=e.length-o>t&&a>o?e.slice(o,a)+"\n"+e.slice(a+1):e.slice(o),c.slice(1)}function v(e){for(var t,n,i="",o=0;o<e.length;o++)t=e.charCodeAt(o),n=re[t],i+=!n&&l(t)?e[o]:n||r(t);return i}function A(e,t,n){var i,r,o="",a=e.tag;for(i=0,r=n.length;r>i;i+=1)j(e,t,n[i],!1,!1)&&(0!==i&&(o+=", "),o+=e.dump);e.tag=a,e.dump="["+o+"]"}function b(e,t,n,i){var r,o,a="",c=e.tag;for(r=0,o=n.length;o>r;r+=1)j(e,t+1,n[r],!0,!0)&&(i&&0===r||(a+=s(e,t)),a+="- "+e.dump);e.tag=c,e.dump=a||"[]"}function w(e,t,n){var i,r,o,a,s,c="",u=e.tag,l=Object.keys(n);for(i=0,r=l.length;r>i;i+=1)s="",0!==i&&(s+=", "),o=l[i],a=n[o],j(e,t,o,!1,!1)&&(e.dump.length>1024&&(s+="? "),s+=e.dump+": ",j(e,t,a,!1,!1)&&(s+=e.dump,c+=s));e.tag=u,e.dump="{"+c+"}"}function C(e,t,n,i){var r,o,a,c,u,l,p="",f=e.tag,d=Object.keys(n);if(e.sortKeys===!0)d.sort();else if("function"==typeof e.sortKeys)d.sort(e.sortKeys);else if(e.sortKeys)throw new N("sortKeys must be a boolean or a function");for(r=0,o=d.length;o>r;r+=1)l="",i&&0===r||(l+=s(e,t)),a=d[r],c=n[a],j(e,t+1,a,!0,!0,!0)&&(u=null!==e.tag&&"?"!==e.tag||e.dump&&e.dump.length>1024,u&&(l+=e.dump&&U===e.dump.charCodeAt(0)?"?":"? "),l+=e.dump,u&&(l+=s(e,t)),j(e,t+1,c,!0,u)&&(l+=e.dump&&U===e.dump.charCodeAt(0)?":":": ",l+=e.dump,p+=l));e.tag=f,e.dump=p||"{}"}function k(e,t,n){var i,r,o,a,s,c;for(r=n?e.explicitTypes:e.implicitTypes,o=0,a=r.length;a>o;o+=1)if(s=r[o],(s.instanceOf||s.predicate)&&(!s.instanceOf||"object"==typeof t&&t instanceof s.instanceOf)&&(!s.predicate||s.predicate(t))){if(e.tag=n?s.tag:"?",s.represent){if(c=e.styleMap[s.tag]||s.defaultStyle,"[object Function]"===T.call(s.represent))i=s.represent(t,c);else{if(!L.call(s.represent,c))throw new N("!<"+s.tag+'> tag resolver accepts not "'+c+'" style');i=s.represent[c](t,c)}e.dump=i}return!0}return!1}function j(e,t,n,i,r,o){e.tag=null,e.dump=n,k(e,n,!1)||k(e,n,!0);var a=T.call(e.dump);i&&(i=e.flowLevel<0||e.flowLevel>t);var s,c,u="[object Object]"===a||"[object Array]"===a;if(u&&(s=e.duplicates.indexOf(n),c=-1!==s),(null!==e.tag&&"?"!==e.tag||c||2!==e.indent&&t>0)&&(r=!1),c&&e.usedDuplicates[s])e.dump="*ref_"+s;else{if(u&&c&&!e.usedDuplicates[s]&&(e.usedDuplicates[s]=!0),"[object Object]"===a)i&&0!==Object.keys(e.dump).length?(C(e,t,e.dump,r),c&&(e.dump="&ref_"+s+e.dump)):(w(e,t,e.dump),c&&(e.dump="&ref_"+s+" "+e.dump));else if("[object Array]"===a)i&&0!==e.dump.length?(b(e,t,e.dump,r),c&&(e.dump="&ref_"+s+e.dump)):(A(e,t,e.dump),c&&(e.dump="&ref_"+s+" "+e.dump));else{if("[object String]"!==a){if(e.skipInvalid)return!1;throw new N("unacceptable kind of an object to dump "+a)}"?"!==e.tag&&h(e,e.dump,t,o)}null!==e.tag&&"?"!==e.tag&&(e.dump="!<"+e.tag+"> "+e.dump)}return!0}function I(e,t){var n,i,r=[],o=[];for(S(e,r,o),n=0,i=o.length;i>n;n+=1)t.duplicates.push(r[o[n]]);t.usedDuplicates=new Array(i)}function S(e,t,n){var i,r,o;if(null!==e&&"object"==typeof e)if(r=t.indexOf(e),-1!==r)-1===n.indexOf(r)&&n.push(r);else if(t.push(e),Array.isArray(e))for(r=0,o=e.length;o>r;r+=1)S(e[r],t,n);else for(i=Object.keys(e),r=0,o=i.length;o>r;r+=1)S(e[i[r]],t,n)}function O(e,t){t=t||{};var n=new o(t);return n.noRefs||I(e,n),j(n,0,e,!0,!0)?n.dump+"\n":""}function E(e,t){return O(e,F.extend({schema:_},t))}var F=e("./common"),N=e("./exception"),M=e("./schema/default_full"),_=e("./schema/default_safe"),T=Object.prototype.toString,L=Object.prototype.hasOwnProperty,D=9,U=10,q=32,Y=33,R=34,B=35,P=37,W=38,K=39,$=42,H=44,G=45,V=58,Z=62,z=63,J=64,Q=91,X=93,ee=96,te=123,ne=124,ie=125,re={};re[0]="\\0",re[7]="\\a",re[8]="\\b",re[9]="\\t",re[10]="\\n",re[11]="\\v",re[12]="\\f",re[13]="\\r",re[27]="\\e",re[34]='\\"',re[92]="\\\\",re[133]="\\N",re[160]="\\_",re[8232]="\\L",re[8233]="\\P";var oe=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],ae=1,se=2,ce=3,ue=4,le=5;t.exports.dump=O,t.exports.safeDump=E},{"./common":2,"./exception":4,"./schema/default_full":9,"./schema/default_safe":10}],4:[function(e,t,n){"use strict";function i(e,t){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack||"",this.name="YAMLException",this.reason=e,this.mark=t,this.message=(this.reason||"(unknown reason)")+(this.mark?" "+this.mark.toString():"")}i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i.prototype.toString=function(e){var t=this.name+": ";return t+=this.reason||"(unknown reason)",!e&&this.mark&&(t+=" "+this.mark.toString()),t},t.exports=i},{}],5:[function(e,t,n){"use strict";function i(e){return 10===e||13===e}function r(e){return 9===e||32===e}function o(e){return 9===e||32===e||10===e||13===e}function a(e){return 44===e||91===e||93===e||123===e||125===e}function s(e){var t;return e>=48&&57>=e?e-48:(t=32|e,t>=97&&102>=t?t-97+10:-1)}function c(e){return 120===e?2:117===e?4:85===e?8:0}function u(e){return e>=48&&57>=e?e-48:-1}function l(e){return 48===e?"\x00":97===e?"":98===e?"\b":116===e?"	":9===e?"	":110===e?"\n":118===e?"\x0B":102===e?"\f":114===e?"\r":101===e?"":32===e?" ":34===e?'"':47===e?"/":92===e?"\\":78===e?"":95===e?" ":76===e?"\u2028":80===e?"\u2029":""}function p(e){return 65535>=e?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function f(e,t){this.input=e,this.filename=t.filename||null,this.schema=t.schema||K,this.onWarning=t.onWarning||null,this.legacy=t.legacy||!1,this.json=t.json||!1,this.listener=t.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function d(e,t){return new B(t,new P(e.filename,e.input,e.position,e.line,e.position-e.lineStart))}function h(e,t){throw d(e,t)}function m(e,t){e.onWarning&&e.onWarning.call(null,d(e,t))}function g(e,t,n,i){var r,o,a,s;if(n>t){if(s=e.input.slice(t,n),i)for(r=0,o=s.length;o>r;r+=1)a=s.charCodeAt(r),9===a||a>=32&&1114111>=a||h(e,"expected valid JSON character");else X.test(s)&&h(e,"the stream contains non-printable characters");e.result+=s}}function y(e,t,n,i){var r,o,a,s;for(R.isObject(n)||h(e,"cannot merge mappings; the provided source object is unacceptable"),r=Object.keys(n),a=0,s=r.length;s>a;a+=1)o=r[a],$.call(t,o)||(t[o]=n[o],i[o]=!0)}function x(e,t,n,i,r,o){var a,s;if(r=String(r),null===t&&(t={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(o))for(a=0,s=o.length;s>a;a+=1)y(e,t,o[a],n);else y(e,t,o,n);else e.json||$.call(n,r)||!$.call(t,r)||h(e,"duplicated mapping key"),t[r]=o,delete n[r];return t}function v(e){var t;t=e.input.charCodeAt(e.position),10===t?e.position++:13===t?(e.position++,10===e.input.charCodeAt(e.position)&&e.position++):h(e,"a line break is expected"),e.line+=1,e.lineStart=e.position}function A(e,t,n){for(var o=0,a=e.input.charCodeAt(e.position);0!==a;){for(;r(a);)a=e.input.charCodeAt(++e.position);if(t&&35===a)do a=e.input.charCodeAt(++e.position);while(10!==a&&13!==a&&0!==a);if(!i(a))break;for(v(e),a=e.input.charCodeAt(e.position),o++,e.lineIndent=0;32===a;)e.lineIndent++,a=e.input.charCodeAt(++e.position)}return-1!==n&&0!==o&&e.lineIndent<n&&m(e,"deficient indentation"),o}function b(e){var t,n=e.position;return t=e.input.charCodeAt(n),(45===t||46===t)&&t===e.input.charCodeAt(n+1)&&t===e.input.charCodeAt(n+2)&&(n+=3,t=e.input.charCodeAt(n),0===t||o(t))}function w(e,t){1===t?e.result+=" ":t>1&&(e.result+=R.repeat("\n",t-1))}function C(e,t,n){var s,c,u,l,p,f,d,h,m,y=e.kind,x=e.result;if(m=e.input.charCodeAt(e.position),o(m)||a(m)||35===m||38===m||42===m||33===m||124===m||62===m||39===m||34===m||37===m||64===m||96===m)return!1;if((63===m||45===m)&&(c=e.input.charCodeAt(e.position+1),o(c)||n&&a(c)))return!1;for(e.kind="scalar",e.result="",u=l=e.position,p=!1;0!==m;){if(58===m){if(c=e.input.charCodeAt(e.position+1),o(c)||n&&a(c))break}else if(35===m){if(s=e.input.charCodeAt(e.position-1),o(s))break}else{if(e.position===e.lineStart&&b(e)||n&&a(m))break;if(i(m)){if(f=e.line,d=e.lineStart,h=e.lineIndent,A(e,!1,-1),e.lineIndent>=t){p=!0,m=e.input.charCodeAt(e.position);continue}e.position=l,e.line=f,e.lineStart=d,e.lineIndent=h;break}}p&&(g(e,u,l,!1),w(e,e.line-f),u=l=e.position,p=!1),r(m)||(l=e.position+1),m=e.input.charCodeAt(++e.position)}return g(e,u,l,!1),e.result?!0:(e.kind=y,e.result=x,!1)}function k(e,t){var n,r,o;if(n=e.input.charCodeAt(e.position),39!==n)return!1;for(e.kind="scalar",e.result="",e.position++,r=o=e.position;0!==(n=e.input.charCodeAt(e.position));)if(39===n){if(g(e,r,e.position,!0),n=e.input.charCodeAt(++e.position),39!==n)return!0;r=o=e.position,e.position++}else i(n)?(g(e,r,o,!0),w(e,A(e,!1,t)),r=o=e.position):e.position===e.lineStart&&b(e)?h(e,"unexpected end of the document within a single quoted scalar"):(e.position++,o=e.position);h(e,"unexpected end of the stream within a single quoted scalar")}function j(e,t){var n,r,o,a,u,l;if(l=e.input.charCodeAt(e.position),34!==l)return!1;for(e.kind="scalar",e.result="",e.position++,n=r=e.position;0!==(l=e.input.charCodeAt(e.position));){if(34===l)return g(e,n,e.position,!0),e.position++,!0;if(92===l){if(g(e,n,e.position,!0),l=e.input.charCodeAt(++e.position),i(l))A(e,!1,t);else if(256>l&&re[l])e.result+=oe[l],e.position++;else if((u=c(l))>0){for(o=u,a=0;o>0;o--)l=e.input.charCodeAt(++e.position),(u=s(l))>=0?a=(a<<4)+u:h(e,"expected hexadecimal character");e.result+=p(a),e.position++}else h(e,"unknown escape sequence");n=r=e.position}else i(l)?(g(e,n,r,!0),w(e,A(e,!1,t)),n=r=e.position):e.position===e.lineStart&&b(e)?h(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}h(e,"unexpected end of the stream within a double quoted scalar")}function I(e,t){var n,i,r,a,s,c,u,l,p,f,d,m=!0,g=e.tag,y=e.anchor,v={};if(d=e.input.charCodeAt(e.position),91===d)a=93,u=!1,i=[];else{if(123!==d)return!1;a=125,u=!0,i={}}for(null!==e.anchor&&(e.anchorMap[e.anchor]=i),d=e.input.charCodeAt(++e.position);0!==d;){if(A(e,!0,t),d=e.input.charCodeAt(e.position),d===a)return e.position++,e.tag=g,e.anchor=y,e.kind=u?"mapping":"sequence",e.result=i,!0;m||h(e,"missed comma between flow collection entries"),p=l=f=null,s=c=!1,63===d&&(r=e.input.charCodeAt(e.position+1),o(r)&&(s=c=!0,e.position++,A(e,!0,t))),n=e.line,_(e,t,H,!1,!0),p=e.tag,l=e.result,A(e,!0,t),d=e.input.charCodeAt(e.position),!c&&e.line!==n||58!==d||(s=!0,d=e.input.charCodeAt(++e.position),A(e,!0,t),_(e,t,H,!1,!0),f=e.result),u?x(e,i,v,p,l,f):s?i.push(x(e,null,v,p,l,f)):i.push(l),A(e,!0,t),d=e.input.charCodeAt(e.position),44===d?(m=!0,d=e.input.charCodeAt(++e.position)):m=!1}h(e,"unexpected end of the stream within a flow collection")}function S(e,t){var n,o,a,s,c=z,l=!1,p=!1,f=t,d=0,m=!1;if(s=e.input.charCodeAt(e.position),124===s)o=!1;else{if(62!==s)return!1;o=!0}for(e.kind="scalar",e.result="";0!==s;)if(s=e.input.charCodeAt(++e.position),43===s||45===s)z===c?c=43===s?Q:J:h(e,"repeat of a chomping mode identifier");else{if(!((a=u(s))>=0))break;0===a?h(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):p?h(e,"repeat of an indentation width identifier"):(f=t+a-1,p=!0)}if(r(s)){do s=e.input.charCodeAt(++e.position);while(r(s));if(35===s)do s=e.input.charCodeAt(++e.position);while(!i(s)&&0!==s)}for(;0!==s;){for(v(e),e.lineIndent=0,s=e.input.charCodeAt(e.position);(!p||e.lineIndent<f)&&32===s;)e.lineIndent++,s=e.input.charCodeAt(++e.position);if(!p&&e.lineIndent>f&&(f=e.lineIndent),i(s))d++;else{if(e.lineIndent<f){c===Q?e.result+=R.repeat("\n",l?1+d:d):c===z&&l&&(e.result+="\n");break}for(o?r(s)?(m=!0,e.result+=R.repeat("\n",l?1+d:d)):m?(m=!1,e.result+=R.repeat("\n",d+1)):0===d?l&&(e.result+=" "):e.result+=R.repeat("\n",d):e.result+=R.repeat("\n",l?1+d:d),l=!0,p=!0,d=0,n=e.position;!i(s)&&0!==s;)s=e.input.charCodeAt(++e.position);g(e,n,e.position,!1)}}return!0}function O(e,t){var n,i,r,a=e.tag,s=e.anchor,c=[],u=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=c),r=e.input.charCodeAt(e.position);0!==r&&45===r&&(i=e.input.charCodeAt(e.position+1),o(i));)if(u=!0,e.position++,A(e,!0,-1)&&e.lineIndent<=t)c.push(null),r=e.input.charCodeAt(e.position);else if(n=e.line,_(e,t,V,!1,!0),c.push(e.result),A(e,!0,-1),r=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>t)&&0!==r)h(e,"bad indentation of a sequence entry");else if(e.lineIndent<t)break;return u?(e.tag=a,e.anchor=s,e.kind="sequence",e.result=c,!0):!1}function E(e,t,n){var i,a,s,c,u=e.tag,l=e.anchor,p={},f={},d=null,m=null,g=null,y=!1,v=!1;for(null!==e.anchor&&(e.anchorMap[e.anchor]=p),c=e.input.charCodeAt(e.position);0!==c;){if(i=e.input.charCodeAt(e.position+1),s=e.line,63!==c&&58!==c||!o(i)){if(!_(e,n,G,!1,!0))break;if(e.line===s){for(c=e.input.charCodeAt(e.position);r(c);)c=e.input.charCodeAt(++e.position);if(58===c)c=e.input.charCodeAt(++e.position),o(c)||h(e,"a whitespace character is expected after the key-value separator within a block mapping"),y&&(x(e,p,f,d,m,null),d=m=g=null),v=!0,y=!1,a=!1,d=e.tag,m=e.result;else{if(!v)return e.tag=u,e.anchor=l,!0;h(e,"can not read an implicit mapping pair; a colon is missed")}}else{if(!v)return e.tag=u,e.anchor=l,!0;h(e,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===c?(y&&(x(e,p,f,d,m,null),d=m=g=null),v=!0,y=!0,a=!0):y?(y=!1,a=!0):h(e,"incomplete explicit mapping pair; a key node is missed"),e.position+=1,c=i;if((e.line===s||e.lineIndent>t)&&(_(e,t,Z,!0,a)&&(y?m=e.result:g=e.result),y||(x(e,p,f,d,m,g),d=m=g=null),A(e,!0,-1),c=e.input.charCodeAt(e.position)),e.lineIndent>t&&0!==c)h(e,"bad indentation of a mapping entry");else if(e.lineIndent<t)break}return y&&x(e,p,f,d,m,null),v&&(e.tag=u,e.anchor=l,e.kind="mapping",e.result=p),v}function F(e){var t,n,i,r,a=!1,s=!1;if(r=e.input.charCodeAt(e.position),33!==r)return!1;if(null!==e.tag&&h(e,"duplication of a tag property"),r=e.input.charCodeAt(++e.position),60===r?(a=!0,r=e.input.charCodeAt(++e.position)):33===r?(s=!0,n="!!",r=e.input.charCodeAt(++e.position)):n="!",t=e.position,a){do r=e.input.charCodeAt(++e.position);while(0!==r&&62!==r);e.position<e.length?(i=e.input.slice(t,e.position),r=e.input.charCodeAt(++e.position)):h(e,"unexpected end of the stream within a verbatim tag")}else{for(;0!==r&&!o(r);)33===r&&(s?h(e,"tag suffix cannot contain exclamation marks"):(n=e.input.slice(t-1,e.position+1),ne.test(n)||h(e,"named tag handle cannot contain such characters"),s=!0,t=e.position+1)),r=e.input.charCodeAt(++e.position);i=e.input.slice(t,e.position),te.test(i)&&h(e,"tag suffix cannot contain flow indicator characters")}return i&&!ie.test(i)&&h(e,"tag name cannot contain such characters: "+i),a?e.tag=i:$.call(e.tagMap,n)?e.tag=e.tagMap[n]+i:"!"===n?e.tag="!"+i:"!!"===n?e.tag="tag:yaml.org,2002:"+i:h(e,'undeclared tag handle "'+n+'"'),!0}function N(e){var t,n;if(n=e.input.charCodeAt(e.position),38!==n)return!1;for(null!==e.anchor&&h(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),t=e.position;0!==n&&!o(n)&&!a(n);)n=e.input.charCodeAt(++e.position);return e.position===t&&h(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(t,e.position),!0}function M(e){var t,n,i;if(i=e.input.charCodeAt(e.position),42!==i)return!1;for(i=e.input.charCodeAt(++e.position),t=e.position;0!==i&&!o(i)&&!a(i);)i=e.input.charCodeAt(++e.position);return e.position===t&&h(e,"name of an alias node must contain at least one character"),n=e.input.slice(t,e.position),e.anchorMap.hasOwnProperty(n)||h(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],A(e,!0,-1),!0}function _(e,t,n,i,r){var o,a,s,c,u,l,p,f,d=1,m=!1,g=!1;if(null!==e.listener&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,o=a=s=Z===n||V===n,i&&A(e,!0,-1)&&(m=!0,e.lineIndent>t?d=1:e.lineIndent===t?d=0:e.lineIndent<t&&(d=-1)),1===d)for(;F(e)||N(e);)A(e,!0,-1)?(m=!0,s=o,e.lineIndent>t?d=1:e.lineIndent===t?d=0:e.lineIndent<t&&(d=-1)):s=!1;if(s&&(s=m||r),1!==d&&Z!==n||(p=H===n||G===n?t:t+1,f=e.position-e.lineStart,1===d?s&&(O(e,f)||E(e,f,p))||I(e,p)?g=!0:(a&&S(e,p)||k(e,p)||j(e,p)?g=!0:M(e)?(g=!0,null===e.tag&&null===e.anchor||h(e,"alias node should not have any properties")):C(e,p,H===n)&&(g=!0,null===e.tag&&(e.tag="?")),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):0===d&&(g=s&&O(e,f))),null!==e.tag&&"!"!==e.tag)if("?"===e.tag){for(c=0,u=e.implicitTypes.length;u>c;c+=1)if(l=e.implicitTypes[c],l.resolve(e.result)){e.result=l.construct(e.result),e.tag=l.tag,null!==e.anchor&&(e.anchorMap[e.anchor]=e.result);break}}else $.call(e.typeMap,e.tag)?(l=e.typeMap[e.tag],null!==e.result&&l.kind!==e.kind&&h(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+l.kind+'", not "'+e.kind+'"'),l.resolve(e.result)?(e.result=l.construct(e.result),null!==e.anchor&&(e.anchorMap[e.anchor]=e.result)):h(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")):h(e,"unknown tag !<"+e.tag+">");return null!==e.listener&&e.listener("close",e),null!==e.tag||null!==e.anchor||g}function T(e){var t,n,a,s,c=e.position,u=!1;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap={},e.anchorMap={};0!==(s=e.input.charCodeAt(e.position))&&(A(e,!0,-1),s=e.input.charCodeAt(e.position),!(e.lineIndent>0||37!==s));){for(u=!0,s=e.input.charCodeAt(++e.position),t=e.position;0!==s&&!o(s);)s=e.input.charCodeAt(++e.position);for(n=e.input.slice(t,e.position),a=[],n.length<1&&h(e,"directive name must not be less than one character in length");0!==s;){for(;r(s);)s=e.input.charCodeAt(++e.position);if(35===s){do s=e.input.charCodeAt(++e.position);while(0!==s&&!i(s));break}if(i(s))break;for(t=e.position;0!==s&&!o(s);)s=e.input.charCodeAt(++e.position);a.push(e.input.slice(t,e.position))}0!==s&&v(e),$.call(se,n)?se[n](e,n,a):m(e,'unknown document directive "'+n+'"')}return A(e,!0,-1),0===e.lineIndent&&45===e.input.charCodeAt(e.position)&&45===e.input.charCodeAt(e.position+1)&&45===e.input.charCodeAt(e.position+2)?(e.position+=3,A(e,!0,-1)):u&&h(e,"directives end mark is expected"),_(e,e.lineIndent-1,Z,!1,!0),A(e,!0,-1),e.checkLineBreaks&&ee.test(e.input.slice(c,e.position))&&m(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&b(e)?void(46===e.input.charCodeAt(e.position)&&(e.position+=3,A(e,!0,-1))):void(e.position<e.length-1&&h(e,"end of the stream or a document separator is expected"))}function L(e,t){e=String(e),t=t||{},0!==e.length&&(10!==e.charCodeAt(e.length-1)&&13!==e.charCodeAt(e.length-1)&&(e+="\n"),65279===e.charCodeAt(0)&&(e=e.slice(1)));var n=new f(e,t);for(n.input+="\x00";32===n.input.charCodeAt(n.position);)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)T(n);return n.documents}function D(e,t,n){var i,r,o=L(e,n);for(i=0,r=o.length;r>i;i+=1)t(o[i])}function U(e,t){var n=L(e,t);if(0!==n.length){if(1===n.length)return n[0];throw new B("expected a single document in the stream, but found more")}}function q(e,t,n){D(e,t,R.extend({schema:W},n))}function Y(e,t){return U(e,R.extend({schema:W},t))}for(var R=e("./common"),B=e("./exception"),P=e("./mark"),W=e("./schema/default_safe"),K=e("./schema/default_full"),$=Object.prototype.hasOwnProperty,H=1,G=2,V=3,Z=4,z=1,J=2,Q=3,X=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,ee=/[\x85\u2028\u2029]/,te=/[,\[\]\{\}]/,ne=/^(?:!|!!|![a-z\-]+!)$/i,ie=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,re=new Array(256),oe=new Array(256),ae=0;256>ae;ae++)re[ae]=l(ae)?1:0,oe[ae]=l(ae);var se={YAML:function(e,t,n){var i,r,o;null!==e.version&&h(e,"duplication of %YAML directive"),1!==n.length&&h(e,"YAML directive accepts exactly one argument"),i=/^([0-9]+)\.([0-9]+)$/.exec(n[0]),null===i&&h(e,"ill-formed argument of the YAML directive"),r=parseInt(i[1],10),o=parseInt(i[2],10),1!==r&&h(e,"unacceptable YAML version of the document"),e.version=n[0],e.checkLineBreaks=2>o,1!==o&&2!==o&&m(e,"unsupported YAML version of the document")},TAG:function(e,t,n){var i,r;2!==n.length&&h(e,"TAG directive accepts exactly two arguments"),i=n[0],r=n[1],ne.test(i)||h(e,"ill-formed tag handle (first argument) of the TAG directive"),$.call(e.tagMap,i)&&h(e,'there is a previously declared suffix for "'+i+'" tag handle'),ie.test(r)||h(e,"ill-formed tag prefix (second argument) of the TAG directive"),e.tagMap[i]=r}};t.exports.loadAll=D,t.exports.load=U,t.exports.safeLoadAll=q,t.exports.safeLoad=Y},{"./common":2,"./exception":4,"./mark":6,"./schema/default_full":9,"./schema/default_safe":10}],6:[function(e,t,n){"use strict";function i(e,t,n,i,r){this.name=e,this.buffer=t,this.position=n,this.line=i,this.column=r}var r=e("./common");i.prototype.getSnippet=function(e,t){var n,i,o,a,s;if(!this.buffer)return null;for(e=e||4,t=t||75,n="",i=this.position;i>0&&-1==="\x00\r\n\u2028\u2029".indexOf(this.buffer.charAt(i-1));)if(i-=1,this.position-i>t/2-1){n=" ... ",i+=5;break}for(o="",a=this.position;a<this.buffer.length&&-1==="\x00\r\n\u2028\u2029".indexOf(this.buffer.charAt(a));)if(a+=1,a-this.position>t/2-1){o=" ... ",a-=5;break}return s=this.buffer.slice(i,a),r.repeat(" ",e)+n+s+o+"\n"+r.repeat(" ",e+this.position-i+n.length)+"^"},i.prototype.toString=function(e){var t,n="";return this.name&&(n+='in "'+this.name+'" '),n+="at line "+(this.line+1)+", column "+(this.column+1),e||(t=this.getSnippet(),t&&(n+=":\n"+t)),n},t.exports=i},{"./common":2}],7:[function(e,t,n){"use strict";function i(e,t,n){var r=[];return e.include.forEach(function(e){n=i(e,t,n)}),e[t].forEach(function(e){n.forEach(function(t,n){t.tag===e.tag&&r.push(n)}),n.push(e)}),n.filter(function(e,t){return-1===r.indexOf(t)})}function r(){function e(e){i[e.tag]=e}var t,n,i={};for(t=0,n=arguments.length;n>t;t+=1)arguments[t].forEach(e);return i}function o(e){this.include=e.include||[],this.implicit=e.implicit||[],this.explicit=e.explicit||[],this.implicit.forEach(function(e){if(e.loadKind&&"scalar"!==e.loadKind)throw new s("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=i(this,"implicit",[]),this.compiledExplicit=i(this,"explicit",[]),this.compiledTypeMap=r(this.compiledImplicit,this.compiledExplicit)}var a=e("./common"),s=e("./exception"),c=e("./type");o.DEFAULT=null,o.create=function(){var e,t;switch(arguments.length){case 1:e=o.DEFAULT,t=arguments[0];break;case 2:e=arguments[0],t=arguments[1];break;default:throw new s("Wrong number of arguments for Schema.create function")}if(e=a.toArray(e),t=a.toArray(t),!e.every(function(e){return e instanceof o}))throw new s("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!t.every(function(e){return e instanceof c}))throw new s("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new o({include:e,explicit:t})},t.exports=o},{"./common":2,"./exception":4,"./type":13}],8:[function(e,t,n){"use strict";var i=e("../schema");t.exports=new i({include:[e("./json")]})},{"../schema":7,"./json":12}],9:[function(e,t,n){"use strict";var i=e("../schema");t.exports=i.DEFAULT=new i({include:[e("./default_safe")],explicit:[e("../type/js/undefined"),e("../type/js/regexp"),e("../type/js/function")]})},{"../schema":7,"../type/js/function":18,"../type/js/regexp":19,"../type/js/undefined":20,"./default_safe":10}],10:[function(e,t,n){"use strict";var i=e("../schema");t.exports=new i({include:[e("./core")],implicit:[e("../type/timestamp"),e("../type/merge")],explicit:[e("../type/binary"),e("../type/omap"),e("../type/pairs"),e("../type/set")]})},{"../schema":7,"../type/binary":14,"../type/merge":22,"../type/omap":24,"../type/pairs":25,"../type/set":27,"../type/timestamp":29,"./core":8}],11:[function(e,t,n){"use strict";var i=e("../schema");t.exports=new i({explicit:[e("../type/str"),e("../type/seq"),e("../type/map")]})},{"../schema":7,"../type/map":21,"../type/seq":26,"../type/str":28}],12:[function(e,t,n){"use strict";var i=e("../schema");t.exports=new i({include:[e("./failsafe")],implicit:[e("../type/null"),e("../type/bool"),e("../type/int"),e("../type/float")]})},{"../schema":7,"../type/bool":15,"../type/float":16,"../type/int":17,"../type/null":23,"./failsafe":11}],13:[function(e,t,n){"use strict";function i(e){var t={};return null!==e&&Object.keys(e).forEach(function(n){e[n].forEach(function(e){t[String(e)]=n})}),t}function r(e,t){if(t=t||{},Object.keys(t).forEach(function(t){if(-1===a.indexOf(t))throw new o('Unknown option "'+t+'" is met in definition of "'+e+'" YAML type.')}),this.tag=e,this.kind=t.kind||null,this.resolve=t.resolve||function(){return!0},this.construct=t.construct||function(e){return e},this.instanceOf=t.instanceOf||null,this.predicate=t.predicate||null,this.represent=t.represent||null,this.defaultStyle=t.defaultStyle||null,this.styleAliases=i(t.styleAliases||null),-1===s.indexOf(this.kind))throw new o('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var o=e("./exception"),a=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],s=["scalar","sequence","mapping"];t.exports=r},{"./exception":4}],14:[function(e,t,n){"use strict";function i(e){if(null===e)return!1;var t,n,i=0,r=e.length,o=p;for(n=0;r>n;n++)if(t=o.indexOf(e.charAt(n)),!(t>64)){if(0>t)return!1;i+=6}return i%8===0}function r(e){var t,n,i=e.replace(/[\r\n=]/g,""),r=i.length,o=p,a=0,c=[];for(t=0;r>t;t++)t%4===0&&t&&(c.push(a>>16&255),c.push(a>>8&255),c.push(255&a)),a=a<<6|o.indexOf(i.charAt(t));return n=r%4*6,0===n?(c.push(a>>16&255),c.push(a>>8&255),c.push(255&a)):18===n?(c.push(a>>10&255),c.push(a>>2&255)):12===n&&c.push(a>>4&255),s?new s(c):c}function o(e){var t,n,i="",r=0,o=e.length,a=p;for(t=0;o>t;t++)t%3===0&&t&&(i+=a[r>>18&63],i+=a[r>>12&63],i+=a[r>>6&63],i+=a[63&r]),r=(r<<8)+e[t];return n=o%3,0===n?(i+=a[r>>18&63],i+=a[r>>12&63],i+=a[r>>6&63],i+=a[63&r]):2===n?(i+=a[r>>10&63],i+=a[r>>4&63],i+=a[r<<2&63],i+=a[64]):1===n&&(i+=a[r>>2&63],i+=a[r<<4&63],i+=a[64],i+=a[64]),i}function a(e){return s&&s.isBuffer(e)}var s;try{var c=e;s=c("buffer").Buffer;
}catch(u){}var l=e("../type"),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";t.exports=new l("tag:yaml.org,2002:binary",{kind:"scalar",resolve:i,construct:r,predicate:a,represent:o})},{"../type":13}],15:[function(e,t,n){"use strict";function i(e){if(null===e)return!1;var t=e.length;return 4===t&&("true"===e||"True"===e||"TRUE"===e)||5===t&&("false"===e||"False"===e||"FALSE"===e)}function r(e){return"true"===e||"True"===e||"TRUE"===e}function o(e){return"[object Boolean]"===Object.prototype.toString.call(e)}var a=e("../type");t.exports=new a("tag:yaml.org,2002:bool",{kind:"scalar",resolve:i,construct:r,predicate:o,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"})},{"../type":13}],16:[function(e,t,n){"use strict";function i(e){return null===e?!1:!!u.test(e)}function r(e){var t,n,i,r;return t=e.replace(/_/g,"").toLowerCase(),n="-"===t[0]?-1:1,r=[],"+-".indexOf(t[0])>=0&&(t=t.slice(1)),".inf"===t?1===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===t?NaN:t.indexOf(":")>=0?(t.split(":").forEach(function(e){r.unshift(parseFloat(e,10))}),t=0,i=1,r.forEach(function(e){t+=e*i,i*=60}),n*t):n*parseFloat(t,10)}function o(e,t){var n;if(isNaN(e))switch(t){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(t){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(t){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(s.isNegativeZero(e))return"-0.0";return n=e.toString(10),l.test(n)?n.replace("e",".e"):n}function a(e){return"[object Number]"===Object.prototype.toString.call(e)&&(e%1!==0||s.isNegativeZero(e))}var s=e("../common"),c=e("../type"),u=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$"),l=/^[-+]?[0-9]+e/;t.exports=new c("tag:yaml.org,2002:float",{kind:"scalar",resolve:i,construct:r,predicate:a,represent:o,defaultStyle:"lowercase"})},{"../common":2,"../type":13}],17:[function(e,t,n){"use strict";function i(e){return e>=48&&57>=e||e>=65&&70>=e||e>=97&&102>=e}function r(e){return e>=48&&55>=e}function o(e){return e>=48&&57>=e}function a(e){if(null===e)return!1;var t,n=e.length,a=0,s=!1;if(!n)return!1;if(t=e[a],"-"!==t&&"+"!==t||(t=e[++a]),"0"===t){if(a+1===n)return!0;if(t=e[++a],"b"===t){for(a++;n>a;a++)if(t=e[a],"_"!==t){if("0"!==t&&"1"!==t)return!1;s=!0}return s}if("x"===t){for(a++;n>a;a++)if(t=e[a],"_"!==t){if(!i(e.charCodeAt(a)))return!1;s=!0}return s}for(;n>a;a++)if(t=e[a],"_"!==t){if(!r(e.charCodeAt(a)))return!1;s=!0}return s}for(;n>a;a++)if(t=e[a],"_"!==t){if(":"===t)break;if(!o(e.charCodeAt(a)))return!1;s=!0}return s?":"!==t?!0:/^(:[0-5]?[0-9])+$/.test(e.slice(a)):!1}function s(e){var t,n,i=e,r=1,o=[];return-1!==i.indexOf("_")&&(i=i.replace(/_/g,"")),t=i[0],"-"!==t&&"+"!==t||("-"===t&&(r=-1),i=i.slice(1),t=i[0]),"0"===i?0:"0"===t?"b"===i[1]?r*parseInt(i.slice(2),2):"x"===i[1]?r*parseInt(i,16):r*parseInt(i,8):-1!==i.indexOf(":")?(i.split(":").forEach(function(e){o.unshift(parseInt(e,10))}),i=0,n=1,o.forEach(function(e){i+=e*n,n*=60}),r*i):r*parseInt(i,10)}function c(e){return"[object Number]"===Object.prototype.toString.call(e)&&e%1===0&&!u.isNegativeZero(e)}var u=e("../common"),l=e("../type");t.exports=new l("tag:yaml.org,2002:int",{kind:"scalar",resolve:a,construct:s,predicate:c,represent:{binary:function(e){return"0b"+e.toString(2)},octal:function(e){return"0"+e.toString(8)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return"0x"+e.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},{"../common":2,"../type":13}],18:[function(e,t,n){"use strict";function i(e){if(null===e)return!1;try{var t="("+e+")",n=s.parse(t,{range:!0});return"Program"===n.type&&1===n.body.length&&"ExpressionStatement"===n.body[0].type&&"FunctionExpression"===n.body[0].expression.type}catch(i){return!1}}function r(e){var t,n="("+e+")",i=s.parse(n,{range:!0}),r=[];if("Program"!==i.type||1!==i.body.length||"ExpressionStatement"!==i.body[0].type||"FunctionExpression"!==i.body[0].expression.type)throw new Error("Failed to resolve function");return i.body[0].expression.params.forEach(function(e){r.push(e.name)}),t=i.body[0].expression.body.range,new Function(r,n.slice(t[0]+1,t[1]-1))}function o(e){return e.toString()}function a(e){return"[object Function]"===Object.prototype.toString.call(e)}var s;try{var c=e;s=c("esprima")}catch(u){"undefined"!=typeof window&&(s=window.esprima)}var l=e("../../type");t.exports=new l("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:i,construct:r,predicate:a,represent:o})},{"../../type":13}],19:[function(e,t,n){"use strict";function i(e){if(null===e)return!1;if(0===e.length)return!1;var t=e,n=/\/([gim]*)$/.exec(e),i="";if("/"===t[0]){if(n&&(i=n[1]),i.length>3)return!1;if("/"!==t[t.length-i.length-1])return!1}return!0}function r(e){var t=e,n=/\/([gim]*)$/.exec(e),i="";return"/"===t[0]&&(n&&(i=n[1]),t=t.slice(1,t.length-i.length-1)),new RegExp(t,i)}function o(e){var t="/"+e.source+"/";return e.global&&(t+="g"),e.multiline&&(t+="m"),e.ignoreCase&&(t+="i"),t}function a(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var s=e("../../type");t.exports=new s("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:i,construct:r,predicate:a,represent:o})},{"../../type":13}],20:[function(e,t,n){"use strict";function i(){return!0}function r(){}function o(){return""}function a(e){return"undefined"==typeof e}var s=e("../../type");t.exports=new s("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:i,construct:r,predicate:a,represent:o})},{"../../type":13}],21:[function(e,t,n){"use strict";var i=e("../type");t.exports=new i("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return null!==e?e:{}}})},{"../type":13}],22:[function(e,t,n){"use strict";function i(e){return"<<"===e||null===e}var r=e("../type");t.exports=new r("tag:yaml.org,2002:merge",{kind:"scalar",resolve:i})},{"../type":13}],23:[function(e,t,n){"use strict";function i(e){if(null===e)return!0;var t=e.length;return 1===t&&"~"===e||4===t&&("null"===e||"Null"===e||"NULL"===e)}function r(){return null}function o(e){return null===e}var a=e("../type");t.exports=new a("tag:yaml.org,2002:null",{kind:"scalar",resolve:i,construct:r,predicate:o,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},{"../type":13}],24:[function(e,t,n){"use strict";function i(e){if(null===e)return!0;var t,n,i,r,o,c=[],u=e;for(t=0,n=u.length;n>t;t+=1){if(i=u[t],o=!1,"[object Object]"!==s.call(i))return!1;for(r in i)if(a.call(i,r)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==c.indexOf(r))return!1;c.push(r)}return!0}function r(e){return null!==e?e:[]}var o=e("../type"),a=Object.prototype.hasOwnProperty,s=Object.prototype.toString;t.exports=new o("tag:yaml.org,2002:omap",{kind:"sequence",resolve:i,construct:r})},{"../type":13}],25:[function(e,t,n){"use strict";function i(e){if(null===e)return!0;var t,n,i,r,o,s=e;for(o=new Array(s.length),t=0,n=s.length;n>t;t+=1){if(i=s[t],"[object Object]"!==a.call(i))return!1;if(r=Object.keys(i),1!==r.length)return!1;o[t]=[r[0],i[r[0]]]}return!0}function r(e){if(null===e)return[];var t,n,i,r,o,a=e;for(o=new Array(a.length),t=0,n=a.length;n>t;t+=1)i=a[t],r=Object.keys(i),o[t]=[r[0],i[r[0]]];return o}var o=e("../type"),a=Object.prototype.toString;t.exports=new o("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:i,construct:r})},{"../type":13}],26:[function(e,t,n){"use strict";var i=e("../type");t.exports=new i("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return null!==e?e:[]}})},{"../type":13}],27:[function(e,t,n){"use strict";function i(e){if(null===e)return!0;var t,n=e;for(t in n)if(a.call(n,t)&&null!==n[t])return!1;return!0}function r(e){return null!==e?e:{}}var o=e("../type"),a=Object.prototype.hasOwnProperty;t.exports=new o("tag:yaml.org,2002:set",{kind:"mapping",resolve:i,construct:r})},{"../type":13}],28:[function(e,t,n){"use strict";var i=e("../type");t.exports=new i("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return null!==e?e:""}})},{"../type":13}],29:[function(e,t,n){"use strict";function i(e){return null===e?!1:null!==s.exec(e)?!0:null!==c.exec(e)}function r(e){var t,n,i,r,o,a,u,l,p,f,d=0,h=null;if(t=s.exec(e),null===t&&(t=c.exec(e)),null===t)throw new Error("Date resolve error");if(n=+t[1],i=+t[2]-1,r=+t[3],!t[4])return new Date(Date.UTC(n,i,r));if(o=+t[4],a=+t[5],u=+t[6],t[7]){for(d=t[7].slice(0,3);d.length<3;)d+="0";d=+d}return t[9]&&(l=+t[10],p=+(t[11]||0),h=6e4*(60*l+p),"-"===t[9]&&(h=-h)),f=new Date(Date.UTC(n,i,r,o,a,u,d)),h&&f.setTime(f.getTime()-h),f}function o(e){return e.toISOString()}var a=e("../type"),s=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),c=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");t.exports=new a("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:i,construct:r,instanceOf:Date,represent:o})},{"../type":13}],"/":[function(e,t,n){"use strict";var i=e("./lib/js-yaml.js");t.exports=i},{"./lib/js-yaml.js":1}]},{},[])("/")});
</script>

<script type="text/javascript">(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports={
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "vmSize": {
      "type": "string",
      "defaultValue": "Standard_D1",
      "metadata": {
        "description": "Instance size for the VMs"
      }
    },
    "storageAccountNamePrefix": {
      "type": "string",
      "maxLength": 7,
      "metadata": {
        "description": "Name prefix for the storage accounts"
      }
    },
    "numberOfNodes": {
      "type": "int",
      "defaultValue": 3,
      "minValue": 3,
      "maxValue": 5, 
      "metadata": {
        "description": "Number of nodes to create"
      }
    },
    "adminUserName": {
      "type": "string",
      "defaultValue": "core",
      "metadata": {
        "description": "Username to login to the VMs"
      }
    },
    "sshKeyData": {
      "type": "string",
      "metadata": {
        "description": "Public key for SSH authentication"
      }
    },
    "cloudConfig": {
      "type": "string",
      "metadata": {
        "description": "Base64-encoded cloud-config.yaml file"
      }
    }
  },
  "variables": {
    "securityGroupName": "mariadb-nsg",
    "virtualNetworkName": "[concat( resourceGroup().name, '-VNet' )]",
    "addressPrefix": "10.0.0.0/16",
    "subnet1Name": "mariadb-subnet",
    "subnet1Prefix": "10.0.1.0/24",
    "subnet1Ref": "[concat(resourceId('Microsoft.Network/virtualNetworks', variables('virtualNetworkName')), '/subnets/', variables('subnet1Name'))]",
    "vmNamePrefix": "mariadb-node-",
    "osImageSku": "Stable",
    "nicNamePrefix": "mariadb-nic-",
    "availabilitySetName": "mariadb-as",
    "vhdStorageAccountName": "[toLower( concat( parameters('storageAccountNamePrefix'), 'vhdo', uniqueString(resourceGroup().id) ) )]",
    "vhdStorageAccountType": "Standard_LRS",
    "diagStorageAccountName": "[toLower( concat( parameters('storageAccountNamePrefix'), 'diag', uniqueString(resourceGroup().id) ) )]",
    "diagStorageAccountType": "Standard_LRS",
    "sshKeyPath": "[concat('/home/', parameters('adminUsername'),'/.ssh/authorized_keys')]",
    "loadBalancerIp": "10.0.1.4",
    "loadBalancerName": "mariadb-lb",
    "backendPoolName": "BackendPoolMySQL",
    "backendPoolRef": "[concat(resourceId('Microsoft.Network/loadBalancers/', variables('loadBalancerName')), '/backendAddressPools/', variables('backendPoolName'))]",
    "lbRef": "[resourceId('Microsoft.Network/loadBalancers', variables('loadBalancerName'))]",
    "lbRuleName": "MySQL-Rule",
    "lbProbeName": "MySQL-Probe"
  },
  "resources": [
    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Storage/storageAccounts",
      "name": "[variables('vhdStorageAccountName')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "accountType": "[variables('vhdStorageAccountType')]"
      }
    },
    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Storage/storageAccounts",
      "name": "[variables('diagStorageAccountName')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "accountType": "[variables('diagStorageAccountType')]"
      }
    },
    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Network/networkSecurityGroups",
      "name": "[variables('securityGroupName')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "securityRules": [
          {
            "name": "SSH",
            "properties": {
              "description": "Allows SSH traffic from the Virtual Network",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "VirtualNetwork",
              "destinationPortRange": "22",
              "destinationAddressPrefix": "*",
              "access": "Allow",
              "priority": 100,
              "direction": "Inbound"
            }
          },
          {
            "name": "MySQL",
            "properties": {
              "description": "Allows MySQL traffic from the Virtual Network",
              "protocol": "Tcp",
              "sourcePortRange": "*",
              "sourceAddressPrefix": "VirtualNetwork",
              "destinationPortRange": "3306",
              "destinationAddressPrefix": "*",
              "access": "Allow",
              "priority": 200,
              "direction": "Inbound"
            }
          }
        ]
      }
    },
    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Network/virtualNetworks",
      "name": "[variables('virtualNetworkName')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "addressSpace": {
          "addressPrefixes": [
            "[variables('addressPrefix')]"
          ]
        },
        "subnets": [
          {
            "name": "[variables('subnet1Name')]",
            "properties": {
              "addressPrefix": "[variables('subnet1Prefix')]"
            }
          }
        ]
      }
    },
    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Network/networkInterfaces",
      "name": "[concat(variables('nicNamePrefix'), copyindex())]",
      "copy": {
        "name": "nicLoop",
        "count": "[parameters('numberOfNodes')]"
      },
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Network/loadBalancers/', variables('loadBalancerName'))]",
        "[concat('Microsoft.Network/networkSecurityGroups/', variables('securityGroupName'))]",
        "[concat('Microsoft.Network/virtualNetworks/', variables('virtualNetworkName'))]"
      ],
      "properties": {
        "ipConfigurations": [
          {
            "name": "ipconfig1",
            "properties": {
              "privateIPAllocationMethod": "Dynamic",
              "subnet": {
                "id": "[variables('subnet1Ref')]"
              },
              "loadBalancerBackendAddressPools": [
                {
                  "id": "[variables('backendPoolRef')]"
                }
              ]
            }
          }
        ],
        "networkSecurityGroup": {
          "id": "[resourceId('Microsoft.Network/networkSecurityGroups', variables('securityGroupName'))]"
        }
      }
    },
    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Compute/availabilitySets",
      "name": "[variables('availabilitySetName')]",
      "location": "[resourceGroup().location]"
    },
    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Network/loadBalancers",
      "name": "[variables('loadBalancerName')]",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Network/virtualNetworks/', variables('virtualNetworkName'))]"
      ],
      "properties": {
        "frontendIPConfigurations": [
          {
            "name": "LoadBalancerFrontend",
            "properties": {
              "subnet": {
                "id": "[variables('subnet1Ref')]"
              },
              "privateIPAddress": "[variables('loadBalancerIp')]",
              "privateIPAllocationMethod": "Static"
            }
          }
        ],
        "backendAddressPools": [
          {
            "name": "[variables('backendPoolName')]"
          }
        ],
        "loadBalancingRules": [
          {
            "name": "[variables('lbRuleName')]",
            "properties": {
              "frontendIPConfiguration": {
                "id": "[concat(variables('lbRef'), '/frontendIpConfigurations/LoadBalancerFrontend')]"
              },
              "backendAddressPool": {
                "id": "[concat(variables('lbRef'), '/backendAddressPools/', variables('backendPoolName'))]"
              },
              "probe": {
                "id": "[concat(variables('lbRef'), '/probes/', variables('lbProbeName'))]"
              },
              "protocol": "Tcp",
              "frontendPort": 3306,
              "backendPort": 3306,
              "idleTimeoutInMinutes": 15
            }
          }
        ],
        "probes": [
          {
            "name": "[variables('lbProbeName')]",
            "properties": {
              "protocol": "Tcp",
              "port": 3306,
              "intervalInSeconds": 15,
              "numberOfProbes": 2
            }
          }
        ]
      }
    },
    {
      "apiVersion": "2015-06-15",
      "type": "Microsoft.Compute/virtualMachines",
      "name": "[concat(variables('vmNamePrefix'), copyindex())]",
      "copy": {
        "name": "vmLoop",
        "count": "[parameters('numberOfNodes')]"
      },
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Storage/storageAccounts/', variables('vhdStorageAccountName'))]",
        "[concat('Microsoft.Storage/storageAccounts/', variables('diagStorageAccountName'))]",
        "[concat('Microsoft.Compute/availabilitySets/', variables('availabilitySetName'))]",
        "[concat('Microsoft.Network/networkInterfaces/', variables('nicNamePrefix'), copyindex())]"
      ],
      "properties": {
        "availabilitySet": {
          "id": "[resourceId('Microsoft.Compute/availabilitySets',variables('availabilitySetName'))]"
        },
        "hardwareProfile": {
          "vmSize": "[parameters('vmSize')]"
        },
        "osProfile": {
          "computerName": "[concat(variables('vmNamePrefix'), copyindex())]",
          "adminUsername": "[parameters('adminUsername')]",
          "customData": "[parameters('cloudConfig')]",
          "linuxConfiguration": {
            "disablePasswordAuthentication": "true",
            "ssh": {
              "publicKeys": [
                {
                  "path": "[variables('sshKeyPath')]",
                  "keyData": "[parameters('sshKeyData')]"
                }
              ]
            }
          }
        },
        "storageProfile": {
          "imageReference": {
            "publisher": "CoreOS",
            "offer": "CoreOS",
            "sku": "[variables('osImageSku')]",
            "version": "latest"
          },
          "osDisk": {
            "name": "[concat(variables('vmNamePrefix'), copyindex())]",
            "vhd": {
              "uri": "[concat('http://',variables('vhdStorageAccountName'),'.blob.core.windows.net/vhds/',variables('vmNamePrefix'), copyindex(),'-OS', '.vhd')]"
            },
            "caching": "ReadWrite",
            "createOption": "FromImage"
          }
        },
        "networkProfile": {
          "networkInterfaces": [
            {
              "id": "[resourceId('Microsoft.Network/networkInterfaces',concat(variables('nicNamePrefix'), copyindex()))]"
            }
          ]
        },
         "diagnosticsProfile": {
          "bootDiagnostics": {
             "enabled": "true",
             "storageUri": "[concat('http://',variables('diagStorageAccountName'),'.blob.core.windows.net')]"
          }
        }
      }
    }
  ]
}

},{}],2:[function(require,module,exports){
// Main application

'use strict'

var forms = require('./forms.source.js')
var cloudConfig = require('./cloud-config.source.js')
var arm = require('./arm.source.js')

$(document).ready(function() {
    // Hide the output panel
    $('[gen-role="page"][gen-page="output"]').hide()
    
    // Restart button action
    $('[gen-role="restart-button"]').on('click', function() {
        $('[gen-role="page"]').show()
            .filter('[gen-page="output"]').hide()
    })
    
    // Form mode: prepare, and set default to Azure Resource Manager template
    forms.prepareFormMode()
    forms.setFormMode('arm')
    
    // Populate all node sizes in the select and bind action to change event to populate data disk select
    forms.nodeSize()
    
    // Callback to show output
    var showOutput = function(armTemplate, yamlString, yamlB64) {
        // Restore button
        $('[gen-role="generate-button"]').prop('disabled', false).text('Generate')
        
        // Show the output panel
        $('[gen-role="page"]').hide()
            .filter('[gen-page="output"]').show()
        
        // Azure Resource Manager template
        if(armTemplate) {
            $('[gen-role="output"][gen-content="arm"]').show()
            $('[gen-role="output"][gen-content="arm"] code').text(armTemplate)
        }
        else {
            $('[gen-role="output"][gen-content="arm"]').hide()
        }
        
        // cloud-config.yaml
        $('[gen-role="output"][gen-content="yaml"] code').text(yamlString)
        $('[gen-role="output"][gen-content="yamlb64"] code').text(yamlB64)
        
        // Highlight syntax
        $('pre code').each(function(i, block) {
            hljs.highlightBlock(block)
        })
    }
    
    // Bind to form submit action
    forms.formSubmit(function(formValues) {
        // Generate the cloud-config.yaml file
        cloudConfig(formValues, function(yamlString, yamlB64) {
            // Generate the Azure Resource Manager template if needed
            var armTemplate = false
            if(formValues.mode == 'arm') {
                armTemplate = arm(formValues, yamlB64)
            }
            
            // Show output
            showOutput(armTemplate, yamlString, yamlB64)
        })
    }, function() {
        // Disable button on click
        $('[gen-role="generate-button"]').prop('disabled', true).text('Generating… Please wait')
    })
})

},{"./arm.source.js":3,"./cloud-config.source.js":6,"./forms.source.js":8}],3:[function(require,module,exports){
'use strict'

var template = require('../azuredeploy.json')
var dataDiskTemplate = require('./data-disk.json')
var storageAccountTemplate = require('./storage-account.json')

// Generate Azure Resource Manager template
module.exports = function(formValues, yamlB64) {
    var result = JSON.parse(JSON.stringify(template))
    
    // Node size
    result.parameters.vmSize.defaultValue = formValues.nodeSize
    
    // Node count
    result.parameters.numberOfNodes.defaultValue = formValues.nodeCount
    
    // Storage account name prefix
    result.parameters.storageAccountNamePrefix.defaultValue = formValues.storageAccountPrefix
    
    // Admin username
    result.parameters.adminUserName.defaultValue = formValues.adminUsername
    
    // SSH key
    result.parameters.sshKeyData.defaultValue = formValues.sshKey
    
    // cloud-config.yaml (base64)
    result.parameters.cloudConfig.defaultValue = yamlB64
    
    // Data disks: create a storage account per each node, since each account can hold 40 VHDs
    result.resources.push(JSON.parse(JSON.stringify(storageAccountTemplate)))
    
    // Add the disks to the VM resource
    for(var i = 0; i < result.resources.length; i++) {
        var res = result.resources[i]
        if(res && res.type && res.type == 'Microsoft.Compute/virtualMachines') {
            // Dependency on the storage accounts
            if(!res.dependsOn) {
                res.dependsOn = []
            }
            res.dependsOn.push("[concat('Microsoft.Storage/storageAccounts/', toLower( concat( parameters('storageAccountNamePrefix'), 'vhd', copyindex(), uniqueString(resourceGroup().id) ) ) )]")
            
            // Attach data disks
            console.log(res.properties.storageProfile)
            if(!res.properties.storageProfile.dataDisks) {
                res.properties.storageProfile.dataDisks = []
            }
            var dataDisks = res.properties.storageProfile.dataDisks
            for(var lun = 0; lun < formValues.dataDisks; lun++) {
                var attach = JSON.parse(JSON.stringify(dataDiskTemplate))
                attach.name = attach.name.replace('*', lun)
                attach.lun = lun
                attach.vhd.uri = attach.vhd.uri.replace('*', lun)
                dataDisks.push(attach)
            }
            
            break
        }
    }
    
    // Return JSON string
    return JSON.stringify(result, false, 2)
}

},{"../azuredeploy.json":1,"./data-disk.json":7,"./storage-account.json":9}],4:[function(require,module,exports){
module.exports={
    "Standard_A1": {
        "cores": 1,
        "disks": 2
    },
    "Standard_A2": {
        "cores": 2,
        "disks": 4
    },
    "Standard_A3": {
        "cores": 4,
        "disks": 8
    },
    "Standard_A4": {
        "cores": 8,
        "disks": 16
    },
    "Standard_A5": {
        "cores": 2,
        "disks": 4
    },
    "Standard_A6": {
        "cores": 4,
        "disks": 8
    },
    "Standard_A7": {
        "cores": 8,
        "disks": 16
    },
    "Standard_A8": {
        "cores": 8,
        "disks": 16
    },
    "Standard_A9": {
        "cores": 16,
        "disks": 16
    },
    "Standard_A10": {
        "cores": 8,
        "disks": 16
    },
    "Standard_A11": {
        "cores": 16,
        "disks": 16
    },
    "Standard_D1": {
        "cores": 1,
        "disks": 2
    },
    "Standard_D2": {
        "cores": 2,
        "disks": 4
    },
    "Standard_D3": {
        "cores": 4,
        "disks": 8
    },
    "Standard_D4": {
        "cores": 8,
        "disks": 16
    },
    "Standard_D11": {
        "cores": 2,
        "disks": 4
    },
    "Standard_D12": {
        "cores": 4,
        "disks": 8
    },
    "Standard_D13": {
        "cores": 8,
        "disks": 16
    },
    "Standard_D14": {
        "cores": 16,
        "disks": 32
    },
    "Standard_D1_v2": {
        "cores": 1,
        "disks": 2
    },
    "Standard_D2_v2": {
        "cores": 2,
        "disks": 4
    },
    "Standard_D3_v2": {
        "cores": 4,
        "disks": 8
    },
    "Standard_D4_v2": {
        "cores": 8,
        "disks": 16
    },
    "Standard_D5_v2": {
        "cores": 16,
        "disks": 32
    },
    "Standard_D11_v2": {
        "cores": 2,
        "disks": 4
    },
    "Standard_D12_v2": {
        "cores": 4,
        "disks": 8
    },
    "Standard_D13_v2": {
        "cores": 8,
        "disks": 16
    },
    "Standard_D14_v2": {
        "cores": 16,
        "disks": 32
    },
    "Standard_D15_v2": {
        "cores": 20,
        "disks": 40
    },
    "Standard_DS1": {
        "cores": 1,
        "disks": 2,
        "premiumStorage": true
    },
    "Standard_DS2": {
        "cores": 2,
        "disks": 4,
        "premiumStorage": true
    },
    "Standard_DS3": {
        "cores": 4,
        "disks": 8,
        "premiumStorage": true
    },
    "Standard_DS4": {
        "cores": 8,
        "disks": 16,
        "premiumStorage": true
    },
    "Standard_DS11": {
        "cores": 2,
        "disks": 4,
        "premiumStorage": true
    },
    "Standard_DS12": {
        "cores": 4,
        "disks": 8,
        "premiumStorage": true
    },
    "Standard_DS13": {
        "cores": 8,
        "disks": 16,
        "premiumStorage": true
    },
    "Standard_DS14": {
        "cores": 16,
        "disks": 32,
        "premiumStorage": true
    },
    "Standard_G1": {
        "cores": 2,
        "disks": 4
    },
    "Standard_G2": {
        "cores": 4,
        "disks": 8
    },
    "Standard_G3": {
        "cores": 8,
        "disks": 16
    },
    "Standard_G4": {
        "cores": 16,
        "disks": 32
    },
    "Standard_G5": {
        "cores": 32,
        "disks": 64
    },
    "Standard_GS1": {
        "cores": 2,
        "disks": 4,
        "premiumStorage": true
    },
    "Standard_GS2": {
        "cores": 4,
        "disks": 8,
        "premiumStorage": true
    },
    "Standard_GS3": {
        "cores": 8,
        "disks": 16,
        "premiumStorage": true
    },
    "Standard_GS4": {
        "cores": 16,
        "disks": 32,
        "premiumStorage": true
    },
    "Standard_GS5": {
        "cores": 32,
        "disks": 64,
        "premiumStorage": true
    }
}
},{}],5:[function(require,module,exports){
module.exports={"create-raid-array.service":"[Unit]\nDescription=Create RAID array on data disks\n\nBefore=mnt-data.mount\n\n[Service]\nType=oneshot\nRemainAfterExit=yes\nExecStart=/usr/bin/bash /opt/bin/create-raid-array.sh\n\n[Install]\nWantedBy=multi-user.target\nRequiredBy=mnt-data.mount\n","create-raid-array.sh":"#!/bin/bash\n\n# List disks that need to be formatted\nDISKS=$(lsblk | awk '/^sd/ { a[$1] = 1 } /^.-/ { sub(/[`|]-/, \"\", $1) ; sub(/[0-9]/, \"\", $1) ; a[$1] = 0 } END { for(x in a) { if(a[x]) { print x }} } ')\nCOUNT=$(echo $DISKS | wc -w)\n\n# Format all disks\nfor i in $DISKS; do\necho \"n\np\n1\n\n\nt\nfd\nw\n\" | fdisk \"/dev/$i\"; done\n\n# Create the raid array md0\nPARTITIONS=\"\"\nfor i in $DISKS; do\n    PARTITIONS+=\"/dev/${i}1 \"\ndone\nmdadm --create /dev/md0 --level 0 --raid-devices $COUNT $PARTITIONS\n\n# Crete an ext4 partition on md0\nmkfs -t ext4 /dev/md0\n","docker-mariadb-galera.service":"[Unit]\nDescription=MariaDB with Galera Cluster\n\nRequires=docker.service\nWants=network-online.target\nAfter=docker.service network-online.target\n\n[Service]\nRestart=always\nRestartSec=3\nTimeoutStartSec=0\n\nExecStartPre=/usr/bin/chmod +x /opt/bin/docker-mariadb-galera.sh\nExecStart=/opt/bin/docker-mariadb-galera.sh\n\nExecStop=/bin/bash -c \" \\\n  HOSTNAME=$(/bin/hostname) \\\n  HOSTNUM=$(/bin/expr $HOSTNAME : '.*\\\\([0-9]\\\\)') \\\n  /usr/bin/docker stop mariadb-container-$HOSTNUM || true \\\n  /usr/bin/docker rm mariadb-container-$HOSTNUM || true \\\n\"\n\n[Install]\nWantedBy=multi-user.target\n","docker-mariadb-galera.sh":"#!/bin/sh\n\n# Parameters\nDATA_DIR=\"/mnt/data\"\nIMAGE_NAME=\"mariadb:10.1\"\n\n# Get the hostname of the VM\nHOSTNAME=$(hostname)\n\n# Get the ID of the VM from the hostname (single-digit)\nHOSTNUM=$(expr \"$HOSTNAME\" : '.*\\([0-9]\\)')\n\n# Get the IP of the eth0 interface\nHOSTIP=$(ip -4 addr ls eth0 | awk '/inet / {print $2}' | cut -d\"/\" -f1)\n\n# Ensure the folder for MariaDB exists\nmkdir -p $DATA_DIR\n\n# Remove pre-existing containers\ndocker kill mariadb-container-$HOSTNUM || true\ndocker rm mariadb-container-$HOSTNUM || true\n\n# Pull the latest version of the Docker image\ndocker pull $IMAGE_NAME\n\n# Check if the cluster is marked as initialized\ncurl --silent --fail http://127.0.0.1:4001/v2/keys/mariadb-galera/initialized > /dev/null\nif [ $? -ne 0 ]; then\n    echo \"Cluster needs to be initialized\"\n    \n    # Check if this is the first VM (hostname ends in \"node-0\") that will initialize the cluster\n    if [[ \"$HOSTNAME\" == *node-0 ]]; then\n        echo \"VM $HOSTNAME is the first node ($HOSTIP)\"\n        \n        # Start the Docker container\n        echo \"Starting Docker container (first node)\"\n        \n        docker run \\\n          --name mariadb-container-$HOSTNUM \\\n          -v /opt/mysql.conf.d:/etc/mysql/conf.d \\\n          -v $DATA_DIR:/var/lib/mysql \\\n          -e MYSQL_INITDB_SKIP_TZINFO=yes \\\n          -e MYSQL_ROOT_PASSWORD=my-secret-pw \\\n          -p 3306:3306 \\\n          -p 4567:4567/udp \\\n          -p 4567-4568:4567-4568 \\\n          -p 4444:4444 \\\n          $IMAGE_NAME \\\n          --wsrep-new-cluster \\\n          --wsrep_node_address=$HOSTIP\n    else\n        echo \"This is not the first node: $HOSTNAME ($HOSTIP)\"\n        \n        # Wait for the cluster to be initialized\n        until curl --fail http://127.0.0.1:4001/v2/keys/mariadb-galera/initialized; do\n          echo \"Waiting for initialization...\"\n          sleep 2\n        done\n        \n        # Touch the mysql data folder so the database is not re-initialized\n        mkdir -p $DATA_DIR/mysql\n        \n        # Start container\n        echo \"Starting Docker container\"\n        docker run \\\n          --name mariadb-container-$HOSTNUM \\\n          -v /opt/mysql.conf.d:/etc/mysql/conf.d \\\n          -v $DATA_DIR:/var/lib/mysql \\\n          -p 3306:3306 \\\n          -p 4567:4567/udp \\\n          -p 4567-4568:4567-4568 \\\n          -p 4444:4444 \\\n          $IMAGE_NAME \\\n          --wsrep_node_address=$HOSTIP\n    fi\nelse\n    echo \"Cluster is already initialized. Node: $HOSTNAME ($HOSTIP)\"\n    \n    echo \"Starting Docker container\"\n    docker run \\\n      --name mariadb-container-$HOSTNUM \\\n      -v /opt/mysql.conf.d:/etc/mysql/conf.d \\\n      -v $DATA_DIR:/var/lib/mysql \\\n      -p 3306:3306 \\\n      -p 4567:4567/udp \\\n      -p 4567-4568:4567-4568 \\\n      -p 4444:4444 \\\n      $IMAGE_NAME \\\n      --wsrep_node_address=$HOSTIP\nfi\n","docker-mariadb-waiter.service":"[Unit]\nDescription=Wait for MariaDB to be initialized, then update status in etcd\n\nRequires=docker.service docker-mariadb-galera.service\nWants=network-online.target\nAfter=docker.service docker-mariadb-galera.service network-online.target\n\n[Service]\nType=simple\nRemainAfterExit=true\nExecStartPre=/usr/bin/chmod +x /opt/bin/docker-mariadb-waiter.sh\nExecStart=/usr/bin/bash /opt/bin/docker-mariadb-waiter.sh\n\n[Install]\nWantedBy=multi-user.target\n","docker-mariadb-waiter.sh":"#!/bin/sh\n\n# This script updates the status in etcd only after MariaDB is actually initialized and ready to accept connections\n\n# Parameters\nIMAGE_NAME=\"mariadb:10.1\"\n\n# Check if the cluster is marked as initialized. If it's already initialized, then just exit successfully\ncurl --silent --fail http://127.0.0.1:4001/v2/keys/mariadb-galera/initialized > /dev/null\nif [ $? -ne 0 ]; then\n    sleep 10\n    \n    while ! docker run --rm $IMAGE_NAME mysqladmin ping -h mariadb-node-0 --silent; do\n        sleep 5\n    done\n    \n    # Wait 5 more seconds before sending the green light\n    sleep 5\n    \n    # Server is ready: other nodes can now connect\n    curl -L http://127.0.0.1:4001/v2/keys/mariadb-galera/initialized -XPUT -d value=\"true\"\nfi\n","etcd-waiter.service":"[Unit]\nDescription=Wait for etcd2 to be online\n\nWants=network-online.target etcd2.service\nAfter=network-online.target etcd2.service\nBefore=docker.service fleet.service\n\n[Service]\nType=oneshot\nRemainAfterExit=true\nExecStartPre=/usr/bin/chmod +x /opt/bin/etcd-waiter.sh\nExecStart=/usr/bin/bash /opt/bin/etcd-waiter.sh\n\n[Install]\nRequiredBy=docker.service\n","etcd-waiter.sh":"#! /usr/bin/bash\nuntil curl http://127.0.0.1:4001/v2/machines; do sleep 2; done\n","mnt-data.mount":"[Unit]\nDescription=Mount RAID array in /mnt/data\n\nRequires=create-raid-array.service\nAfter=create-raid-array.service\nBefore=docker-mariadb-galera.service\n\n[Mount]\nWhat=/dev/md0\nWhere=/mnt/data\nType=ext4\n\n[Install]\nRequiredBy=docker-mariadb-galera.service\n","mysql_server.cnf":"[server]\nbind-address=0.0.0.0\nbinlog_format=row\ndefault_storage_engine=InnoDB\ninnodb_autoinc_lock_mode=2\ninnodb_locks_unsafe_for_binlog=1\nquery_cache_size=0\nquery_cache_type=0\n\n[galera]\nwsrep_on=ON\nwsrep_provider=\"/usr/lib/galera/libgalera_smm.so\"\nwsrep_cluster_address=\"gcomm://mariadb-node-0,mariadb-node-1,mariadb-node-2,mariadb-node-3,mariadb-node-4\"\nwsrep-sst-method=rsync\n\n# Optional setting\nwsrep_slave_threads={WSREP_SLAVE_THREADS}\n#innodb_flush_log_at_trx_commit=0\n"}
},{}],6:[function(require,module,exports){
'use strict'

var pack = require('./cloud-config.pack.json')
var yamlSource = require('./yaml.source.js')
var yamlARMSource = require('./yaml-arm.source.js')
var azureVMSizes = require('./azure-vm-sizes.json')

// URL for the CORS proxy service, to circument the Same-Origin Policy
// By default we're using the public service by CrossOrigin.me
// You can grab the source code for the app at https://github.com/technoboy10/crossorigin.me and run your own instance of the CORS proxy, then change the URL below
var corsProxyUrl = 'https://crossorigin.me/'

// Entry-point for the unit. Generate the cloud-config.yaml file
var cloudConfig = function(formValues, done) {
    // Check if the etcd2 discovery URL has been passed
    if(!formValues.discoveryUrl) {
        // Need to request discovery url from https://discovery.etcd.io/new?size=X
        var nodes = formValues.nodeCount || formValues.etcdNodeCount
        $.get(corsProxyUrl + 'https://discovery.etcd.io/new?size='+nodes, function(result) {
            // result should contain the etcd discovery url
            if(!result || !result.match(/^https\:\/\/discovery\.etcd\.io\/[a-f0-9]{32}$/)) {
                alert('Invalid response from discovery.etcd.io')
            }
            else {
                // Build YAML file
                formValues.discoveryUrl = result
                buildYaml(formValues, done)
            }
        })
    }
    else {
        // Go straight to building the YAML file
        buildYaml(formValues, done)
    } 
}

// Build the cloud-config.yaml file
var buildYaml = function(formValues, done) {
    // Select the proper template
    var template = (formValues.mode == 'arm') ? yamlARMSource : yamlSource
    
    // Create the tree
    var yamlTree = Object.assign({}, template.tree)
    
    // etcd2 discovery url
    yamlTree.coreos.etcd2.discovery = formValues.discoveryUrl
    
    // Number of cores
    var vcpus = 0
    if(formValues.nodeSize) {
        var nodeSize = azureVMSizes[formValues.nodeSize]
        if(nodeSize && nodeSize.cores) {
            vcpus = nodeSize.cores
        }
    }
    else if(formValues.vcpuCount) {
        vcpus = formValues.vcpuCount
    }
    
    // Read files to be created and append the data to the yaml tree
    for(var k in template.readFiles) {
        if(template.readFiles.hasOwnProperty(k)) {
            var push = Object.assign({}, template.readFiles[k]) // Clone the object
            push.content = pack[k]
            
            if(k == 'mysql_server.cnf') {
                push.content = push.content.replace('{WSREP_SLAVE_THREADS}', (2 * vcpus) || 1)
            }
            
            yamlTree.write_files.push(push)
        }
    }
    
    // systemd units
    for(var i = 0, len = template.units.length; i < len; i++) {
        var unit = template.units[i]
        
        var push = Object.assign({}, unit) // Clone the object
        delete push.source
        delete push['drop-ins-source']
        
        if(unit['drop-ins-source']) {
            push['drop-ins'] = []
            for(var k in unit['drop-ins-source']) {
                if(unit['drop-ins-source'].hasOwnProperty(k)) {
                    push['drop-ins'].push({
                        name: k,
                        content: pack[k]
                    })
                }
            }
        }
        if(unit.source) {
            push.content = pack[unit.source]
        }
        
        yamlTree.coreos.units.push(push)
    }
    
    // Generate YAML document
    var yamlString = "#cloud-config\n\n" + jsyaml.safeDump(yamlTree, {lineWidth: -1})
    
    // Convert to base64 (note: this does NOT support UTF-8)
    var yamlB64 = btoa(yamlString)
    
    done(yamlString, yamlB64)
}

module.exports = cloudConfig

},{"./azure-vm-sizes.json":4,"./cloud-config.pack.json":5,"./yaml-arm.source.js":10,"./yaml.source.js":11}],7:[function(require,module,exports){
module.exports={
	"name": "DataDisk*",
	"diskSizeGB": "1023",
	"lun": 0,
	"vhd": {
		"uri": "[concat('http://', toLower( concat( parameters('storageAccountNamePrefix'), 'vhd', copyindex(), uniqueString(resourceGroup().id) ) ), '.blob.core.windows.net/vhds/',variables('vmNamePrefix'), copyindex(),'-DataDisk*', '.vhd')]"
	},
	"caching": "None",
	"createOption": "Empty"
}

},{}],8:[function(require,module,exports){
'use strict'

var azureVMSizes = require('./azure-vm-sizes.json')

var formMode = false

var setFormMode = function(newMode) {
    // Reset visual state, then set the proper one
    $('[gen-role="mode"]').removeClass('active')
        .filter('[gen-mode="'+newMode+'"]').addClass('active')
    $('[gen-role="conditional-param"]').hide()
        .filter('[gen-mode="'+newMode+'"]').show()
    $('[gen-role="conditional-param"] input').prop('disabled', true)
        .filter('[gen-mode="'+newMode+'"] input').prop('disabled', false)
    $('[gen-role="conditional-param"] select').prop('disabled', true)
        .filter('[gen-mode="'+newMode+'"] select').prop('disabled', false)
    $('[gen-role="conditional-param"] textarea').prop('disabled', true)
        .filter('[gen-mode="'+newMode+'"] textarea').prop('disabled', false)
    
    // Set value
    formMode = newMode
}

var prepareFormMode = function() {
    // Add callbacks
    $('[gen-role="mode"]').on('click', function(event) {
        event.preventDefault()
        
        setFormMode($(this).attr('gen-mode'))
    })
}

var dataDiskUpdate = function(sizeName) {
    // Maximum number of data disks, limited to 40
    var max = 2
    var size = azureVMSizes[sizeName]
    if(size && size.disks) {
        max = size.disks
    }
    if(max > 40) {
        max = 40
    }
    
    // Add options
    var $dataDiskSelect = $('#data-disks')
    $dataDiskSelect.empty()
    for(var i = 2; i <= max; i++) {
        $dataDiskSelect.append('<option value="'+i+'">'+i+'</option>')
    }
    
    // Set value to the maximum one
    $dataDiskSelect.val(max)
}

var nodeSize = function() {
    // Populate all nodes in the select
    var $nodeSizeSelect = $('#node-size')
    for(var k in azureVMSizes) {
        if(azureVMSizes.hasOwnProperty(k)) {
            $nodeSizeSelect.append('<option value="'+k+'">'+k+'</option>')
        }
    }
    
    // Bind action to change event, to update select for data disk count
    $nodeSizeSelect.on('change', function() {
        dataDiskUpdate($nodeSizeSelect.val())
    })
    
    // Initial population of data disk count
    dataDiskUpdate($nodeSizeSelect.val())
}

var formSubmit = function(done, click) {
    var $form = $('#generator-form')
    $form.submit(function(event) {
        // Prevent submission
        event.preventDefault()
        
        // Remove error messages from all groups
        $('.form-group').removeClass('has-error')
        
        // Collect all values and make sure they're correct
        var formValues = {
            mode: formMode
        }
        
        // For mode ARM
        if(formMode == 'arm') {
            // Number of nodes
            var $nodeCount = $('#node-count', $form)
            formValues.nodeCount = parseInt($nodeCount.val())
            if(!(~[3,5].indexOf(formValues.nodeCount))) {
                $nodeCount.parents('.form-group').addClass('has-error')
                return false
            }
            
            // Node size
            var $nodeSize = $('#node-size', $form)
            formValues.nodeSize = $nodeSize.val() + ''
            if(!(~Object.keys(azureVMSizes).indexOf(formValues.nodeSize))) {
                $nodeSize.parents('.form-group').addClass('has-error')
                return false
            }
            
            // Data disks
            var $dataDisks = $('#data-disks', $form)
            formValues.dataDisks = parseInt($dataDisks.val())
            if(formValues.dataDisks < 2 || formValues.dataDisks > azureVMSizes[formValues.nodeSize].disks || formValues.dataDisks > 40) {
                $dataDisks.parents('.form-group').addClass('has-error')
                return false
            }
            
            // Storage account name prefix
            var $storageAccountPrefix = $('#storage-account-prefix', $form)
            formValues.storageAccountPrefix = ($storageAccountPrefix.val() + '').trim()
            if(!formValues.storageAccountPrefix.match(/^[0-9a-z]{1,7}$/)) {
                $storageAccountPrefix.parents('.form-group').addClass('has-error')
                return false
            }
            
            // SSH key
            var $sshKey = $('#ssh-key', $form)
            formValues.sshKey = ($sshKey.val() + '').trim()
            if(!formValues.sshKey.match(/^ssh-(rsa|dss) AAAA[0-9A-Za-z+/]+[=]{0,3}/)) {
                $sshKey.parents('.form-group').addClass('has-error')
                return false
            }
            
            // Admin username
            var $adminUsername = $('#admin-username', $form)
            formValues.adminUsername = ($adminUsername.val() + '').trim()
            if(!formValues.adminUsername.match(/^[a-z_][a-z0-9_-]*$/)) {
                $adminUsername.parents('.form-group').addClass('has-error')
                return false
            }
        }
        else if(formMode == 'cloudconfig') {
            // vCPU count
            var $vcpuCount = $('#vcpu-count', $form)
            formValues.vcpuCount = parseInt($vcpuCount.val())
            if(formValues.vcpuCount < 0 || formValues.vcpuCount > 32) {
                $vcpuCount.parents('.form-group').addClass('has-error')
                return false
            }
            
            // etcd2 node count
            var $etcdNodeCount = $('#etcd-node-count', $form)
            formValues.etcdNodeCount = parseInt($etcdNodeCount.val())
            if(formValues.etcdNodeCount < 1) {
                $etcdNodeCount.parents('.form-group').addClass('has-error')
                return false
            }
        }
        
        // etcd discovery URL
        var $discoveryUrl = $('#etcd-discovery-url', $form)
        formValues.discoveryUrl = ($discoveryUrl.val() + '').trim()
        if(!formValues.discoveryUrl) {
            // Empty = auto-generate
            formValues.discoveryUrl = false
        }
        else if(!formValues.discoveryUrl.match(/^https\:\/\/discovery\.etcd\.io\/[a-f0-9]{32}$/)) {
            $discoveryUrl.parents('.form-group').addClass('has-error')
            return false
        }
        
        // Invoke click callback if necessary
        if(click) {
            click()
        }
        
        // Invoke callback
        if(done) {
            done(formValues)
        }
        
        // Prevent submission
        return false
    })
}

module.exports = {
    prepareFormMode: prepareFormMode,
    setFormMode: setFormMode,
    nodeSize: nodeSize,
    formSubmit: formSubmit
}

},{"./azure-vm-sizes.json":4}],9:[function(require,module,exports){
module.exports={
	"apiVersion": "2015-06-15",
	"type": "Microsoft.Storage/storageAccounts",
	"name": "[toLower( concat( parameters('storageAccountNamePrefix'), 'vhd', copyindex(), uniqueString(resourceGroup().id) ) )]",
	"copy": {
		"name": "storageLoop",
		"count": "[parameters('numberOfNodes')]"
	},
	"location": "[resourceGroup().location]",
	"properties": {
		"accountType": "[variables('vhdStorageAccountType')]"
	}
}
},{}],10:[function(require,module,exports){
'use strict'

// Source for the cloud-config.yaml file
module.exports = {
    // JSON structure for the cloud-config.yaml file
    tree: {
        "write_files": [],
        "coreos": {
            "update": {
                "reboot-strategy": "etcd-lock"
            },
            "etcd2": {
                "discovery": false,
                "advertise-client-urls": "http://$private_ipv4:2379,http://$private_ipv4:4001",
                "initial-advertise-peer-urls": "http://$private_ipv4:2380",
                "listen-client-urls": "http://0.0.0.0:2379,http://0.0.0.0:4001",
                "listen-peer-urls": "http://$private_ipv4:2380"
            },
            "units": []
        }
    },

    // List of files for write_files
    readFiles: {
        'docker-mariadb-galera.sh': {
            'path': '/opt/bin/docker-mariadb-galera.sh',
            'owner': 'root',
            'permissions': '0755'
        },
        'docker-mariadb-waiter.sh': {
            'path': '/opt/bin/docker-mariadb-waiter.sh',
            'owner': 'root',
            'permissions': '0755'
        },
        'etcd-waiter.sh': {
            'path': '/opt/bin/etcd-waiter.sh',
            'owner': 'root',
            'permissions': '0755'
        },
        'mysql_server.cnf': {
            'path': '/opt/mysql.conf.d/mysql_server.cnf',
            'owner': 'root',
            'permissions': '0644'
        },
        'create-raid-array.sh': {
            'path': '/opt/bin/create-raid-array.sh',
            'owner': 'root',
            'permissions': '0755'
        },
    },

    // List of systemd units
    units: [
        { 'name': 'docker.service', 'command': 'start' },
        { 'name': 'etcd2.service', 'command': 'start' },
        { 'name': 'docker-mariadb-galera.service', 'command': 'start', 'source': 'docker-mariadb-galera.service' },
        { 'name': 'docker-mariadb-waiter.service', 'command': 'start', 'source': 'docker-mariadb-waiter.service' },
        { 'name': 'etcd-waiter.service', 'command': 'start', 'source': 'etcd-waiter.service' },
        { 'name': 'create-raid-array.service', 'command': 'start', 'source': 'create-raid-array.service' },
        { 'name': 'mnt-data.mount', 'command': 'start', 'source': 'mnt-data.mount' },
    ]
}

},{}],11:[function(require,module,exports){
'use strict'

// Source for the cloud-config.yaml file
module.exports = {
    // JSON structure for the cloud-config.yaml file
    tree: {
        "write_files": [],
        "coreos": {
            "update": {
                "reboot-strategy": "etcd-lock"
            },
            "etcd2": {
                "discovery": false,
                "advertise-client-urls": "http://$private_ipv4:2379,http://$private_ipv4:4001",
                "initial-advertise-peer-urls": "http://$private_ipv4:2380",
                "listen-client-urls": "http://0.0.0.0:2379,http://0.0.0.0:4001",
                "listen-peer-urls": "http://$private_ipv4:2380"
            },
            "units": []
        }
    },

    // List of files for write_files
    readFiles: {
        'docker-mariadb-galera.sh': {
            'path': '/opt/bin/docker-mariadb-galera.sh',
            'owner': 'root',
            'permissions': '0755'
        },
        'docker-mariadb-waiter.sh': {
            'path': '/opt/bin/docker-mariadb-waiter.sh',
            'owner': 'root',
            'permissions': '0755'
        },
        'etcd-waiter.sh': {
            'path': '/opt/bin/etcd-waiter.sh',
            'owner': 'root',
            'permissions': '0755'
        },
        'mysql_server.cnf': {
            'path': '/opt/mysql.conf.d/mysql_server.cnf',
            'owner': 'root',
            'permissions': '0644'
        }
    },

    // List of systemd units
    units: [
        { 'name': 'docker.service', 'command': 'start' },
        { 'name': 'etcd2.service', 'command': 'start' },
        { 'name': 'docker-mariadb-galera.service', 'command': 'start', 'source': 'docker-mariadb-galera.service' },
        { 'name': 'docker-mariadb-waiter.service', 'command': 'start', 'source': 'docker-mariadb-waiter.service' },
        { 'name': 'etcd-waiter.service', 'command': 'start', 'source': 'etcd-waiter.service' },
    ]
}

},{}]},{},[2]);
</script>

<!-- highlight.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.2.0/highlight.min.js"></script>

</body>
</html>
